<!-- Header Component -->
<app-header></app-header>

<!-- Back to Cart Link - Outside container -->
<div class="back-section">
  <button class="back-btn" (click)="goBackToCart()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 12H5"></path>
      <path d="M12 19l-7-7 7-7"></path>
    </svg>
    {{ 'checkout.backToCart' | translate }}
  </button>
</div>

<!-- Main Checkout Content -->
<main class="checkout-page">
  <div class="container">

    <!-- Page Title -->
    <div class="title-section">
      <h1 class="page-title">{{ 'checkout.title' | translate }}</h1>
      <p class="page-subtitle">{{ 'checkout.subtitle' | translate }}</p>
    </div>

    <!-- Checkout Content Grid -->
    <div class="checkout-content">
      
      <!-- Left Column - Delivery Information Form -->
      <div class="delivery-section">
        <div class="delivery-card">
          <h2 class="card-title">{{ 'checkout.deliveryInformation' | translate }}</h2>
          
          <form [formGroup]="deliveryForm" (ngSubmit)="placeOrder()" class="delivery-form">
            
            <!-- Full Name Field -->
            <div class="form-group">
              <label for="fullName" class="form-label">{{ 'checkout.form.fullName' | translate }}</label>
              <input
                type="text"
                id="fullName"
                formControlName="fullName"
                class="form-input"
                [class.error]="hasError('fullName', 'required') || hasError('fullName', 'minlength')"
                placeholder="{{ 'checkout.form.fullNamePlaceholder' | translate }}">
              @if (hasError('fullName', 'required') || hasError('fullName', 'minlength')) {
                <span class="error-message">{{ getErrorMessage('fullName') }}</span>
              }
            </div>

            <!-- Delivery Address Field -->
            <div class="form-group">
              <label for="address" class="form-label">{{ 'checkout.form.address' | translate }}</label>
              <input
                type="text"
                id="address"
                formControlName="address"
                class="form-input"
                [class.error]="hasError('address', 'required') || hasError('address', 'minlength')"
                placeholder="{{ 'checkout.form.addressPlaceholder' | translate }}">
              @if (hasError('address', 'required') || hasError('address', 'minlength')) {
                <span class="error-message">{{ getErrorMessage('address') }}</span>
              }
            </div>

            <!-- Phone Number Field -->
            <div class="form-group">
              <label for="phone" class="form-label">{{ 'checkout.form.phone' | translate }}</label>
              <input
                type="tel"
                id="phone"
                formControlName="phone"
                class="form-input"
                [class.error]="hasError('phone', 'required') || hasError('phone', 'pattern')"
                placeholder="{{ 'checkout.form.phonePlaceholder' | translate }}">
              @if (hasError('phone', 'required') || hasError('phone', 'pattern')) {
                <span class="error-message">{{ getErrorMessage('phone') }}</span>
              }
            </div>
          </form>
        </div>
      </div>

      <!-- Right Column - Order Summary -->
      <div class="order-summary-section">
        <div class="order-summary-card">
          <h2 class="summary-title">{{ 'checkout.orderSummary' | translate }}</h2>
          
          <!-- Cart Items List -->
          <div class="order-items">
            @for (item of cartItems(); track item.id) {
              <div class="order-item">
                <div class="item-image">
                  <img [src]="item.product.image" [alt]="item.product.title" loading="lazy">
                </div>
                <div class="item-details">
                  <h4 class="item-title">{{ item.product.title }}</h4>
                  <div class="item-quantity">{{ item.quantity }} Ã— ${{ item.product.price | number:'1.2-2' }}</div>
                </div>
                <div class="item-total">
                  ${{ item.lineTotal | number:'1.2-2' }}
                </div>
              </div>
            }
          </div>
          
          <!-- Summary Totals -->
          <div class="summary-totals">
            <div class="summary-row">
              <span class="summary-label">{{ 'checkout.subtotal' | translate }}</span>
              <span class="summary-value">${{ cartSummary().subtotal | number:'1.2-2' }}</span>
            </div>
            
            <div class="summary-row">
              <span class="summary-label">{{ 'checkout.shipping' | translate }}</span>
              <span class="summary-value shipping-free">{{ 'checkout.shippingFree' | translate }}</span>
            </div>
            
            <div class="summary-divider"></div>
            
            <div class="summary-row total-row">
              <span class="summary-label">{{ 'checkout.total' | translate }}</span>
              <span class="summary-total">${{ cartSummary().total | number:'1.2-2' }}</span>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="checkout-actions">
            <button 
              type="button"
              class="place-order-btn"
              (click)="placeOrder()"
              [disabled]="!deliveryForm.valid">
              {{ 'checkout.placeOrder' | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty Cart State -->
    @if (cartItems().length === 0) {
      <div class="empty-cart">
        <div class="empty-cart-content">
          <h2>{{ 'checkout.empty.title' | translate }}</h2>
          <p>{{ 'checkout.empty.message' | translate }}</p>
          <button class="continue-shopping-btn" (click)="continueShopping()">
            {{ 'checkout.continueShopping' | translate }}
          </button>
        </div>
      </div>
    }
  </div>
</main>